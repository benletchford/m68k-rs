# Dockerfile for Musashi-based fixture verification
# Builds Musashi and the verify tool to test coverage fixtures against reference emulator
FROM debian:bookworm-slim

RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        build-essential \
        make \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /build

# Copy Musashi source and verify tool
COPY Musashi/ /build/Musashi/
COPY verify/ /build/verify/

# Build Musashi verifier
WORKDIR /build/verify
RUN MUSASHI_DIR=/build/Musashi make

# Set up for running tests
WORKDIR /work
ENTRYPOINT ["/build/verify/musashi_verify"]
